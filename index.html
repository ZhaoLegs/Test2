<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>系统视频播放演示</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: grid;
      min-height: 100vh;
      place-items: center;
    }
    main {
      width: 100%;
      max-width: 800px;
      padding: 16px;
      box-sizing: border-box;
      text-align: center;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 12px;
      font-weight: 600;
    }
    .player-wrap {
      display: grid;
      place-items: center;
      position: relative;
    }
    video {
      width: 100%;
      max-height: 70vh;
      border-radius: 8px;
      background: #111827;
    }
    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      place-items: center;
    }
    .android-controls {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 8px;
      display: none;
      pointer-events: auto;
      display: flex;
      justify-content: center;
      gap: 16px;
    }
    .rotate-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 36px;
      padding: 0 12px;
      border-radius: 18px;
      background: rgba(34,197,94,0.9);
      color: #0b1021;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
    }
    .play-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(34,197,94,0.9);
      color: #0b1021;
      font-size: 24px;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }
    .actions {
      margin-top: 12px;
    }
    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 6px;
      background: #22c55e;
      color: #0b1021;
      text-decoration: none;
      font-weight: 600;
    }
    .hint {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 8px;
    }
  </style>
  <!-- iOS PWA/Safari 兼容性优化（可选） -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="format-detection" content="telephone=no,email=no,address=no">
  <meta name="theme-color" content="#0f172a">
</head>
<body>
  <main>
    
    <div class="player-wrap">
      <video id="player" controls preload="metadata" poster="https://picsum.photos/seed/video-cover/800/450">
        <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4">
        您的浏览器不支持 HTML5 视频。
      </video>
      <div id="overlay" class="overlay">
        <button id="overlayPlay" class="play-btn">▶</button>
      </div>
      <div id="androidControls" class="android-controls">
        <button id="rotateBtn" class="rotate-btn">旋转屏幕</button>
      </div>
    </div>
    <div class="actions">
      <div class="hint">提示：不使用第三方库，使用 iOS/Android 原生控制。</div>
    </div>
  </main>
  <script>
    (function () {
      const video = document.getElementById('player');
      
      
      const overlay = document.getElementById('overlay');
      const overlayPlay = document.getElementById('overlayPlay');
      const androidControls = document.getElementById('androidControls');
      const rotateBtn = document.getElementById('rotateBtn');
      
      const ua = navigator.userAgent || '';
      const isIOS = /iPhone|iPad|iPod/i.test(ua);
      const isAndroid = /Android/i.test(ua);

      if (isIOS) {
        video.removeAttribute('playsinline');
        video.removeAttribute('webkit-playsinline');
        video.removeAttribute('controlsList');
        video.controls = false;
      } else if (isAndroid) {
        video.removeAttribute('playsinline');
        video.removeAttribute('x5-playsinline');
        video.setAttribute('x5-video-player-type', 'h5');
        video.setAttribute('x5-video-orientation', 'portrait');
        video.setAttribute('controlsList', 'nodownload noplaybackrate');
        video.setAttribute('disablepictureinpicture', '');
        video.controls = true;
      }

      const lockPortrait = () => {
        if (isAndroid && screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('portrait').catch(function () {});
        }
      };
      const enterFullscreen = () => {
        try {
          if (video.requestFullscreen) {
            const p = video.requestFullscreen();
            if (p && typeof p.then === 'function') {
              p.then(lockPortrait).catch(lockPortrait);
            } else {
              lockPortrait();
            }
          } else if (video.webkitEnterFullscreen) {
            video.webkitEnterFullscreen();
            lockPortrait();
          } else {
            lockPortrait();
          }
        } catch (e) {
          lockPortrait();
        }
      };

      if (isIOS || isAndroid) {
        video.addEventListener('play', enterFullscreen, { once: true });
        if (isIOS) {
          overlay.style.display = 'grid';
          overlayPlay.addEventListener('click', function () {
            enterFullscreen();
            video.play();
            overlay.style.display = 'none';
          });
          video.addEventListener('playing', function () {
            overlay.style.display = 'none';
          });
        } else if (isAndroid) {
          overlay.style.display = 'none';
        }
        document.addEventListener('fullscreenchange', function () {
          if (document.fullscreenElement === video) {
            // Android 使用系统控件，保持底部控件状态不变
            if (isAndroid) {
              androidControls.style.display = 'flex';
            }
          } else {
            video.controls = true;
            overlay.style.display = 'none';
            if (isAndroid) {
              androidControls.style.display = 'none';
            }
          }
        });
        // iOS 兼容：退出原生全屏后显示底部控件，不再显示中间按钮
        video.addEventListener('webkitendfullscreen', function () {
          video.controls = true;
          overlay.style.display = 'none';
        });

        if (isAndroid) {
          if (rotateBtn) {
            rotateBtn.addEventListener('click', function () {
              try {
                if (screen.orientation && screen.orientation.type) {
                  if (/portrait/i.test(screen.orientation.type)) {
                    screen.orientation.lock('landscape').catch(function () {});
                  } else {
                    screen.orientation.lock('portrait').catch(function () {});
                  }
                } else {
                  screen.orientation.lock('landscape').catch(function () {});
                }
              } catch (e) {}
            });
          }
        }
      }

      

      
    })();
  </script>
  
</body>
</html>
